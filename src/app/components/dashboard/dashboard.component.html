<!-- Drawer de notificaciones -->
<app-notification-drawer></app-notification-drawer>

<div class="dashboard-wrapper">
  <div class="sticky-buttons" [class.scrolled]="isScrolled">
    <!-- Sección superior: Utilidades -->
    <div class="buttons-container utility-section">
      <div class="left-buttons">
        <button mat-button class="action-button" (click)="selectAllRequests()">
          <mat-icon class="icon">{{ isAllRequestsSelected() ? 'check_box' : 'check_box_outline_blank' }}</mat-icon>
          {{ isAllRequestsSelected() ? 'Deseleccionar todo' : 'Seleccionar todo' }}
        </button>

        <button mat-button class="action-button" (click)="copyToClipboard()">
          <mat-icon class="icon">content_copy</mat-icon>
          Copiar al portapapeles
        </button>
      </div>

      <div class="right-buttons">
        <div class="filter-input-container">
          <mat-icon class="search-icon"
            matTooltip="Búsqueda avanzada: use 'columna:valor' para filtrar por una columna en específico. Ejemplo: 
 'N° Solicitud:7485'"
            matTooltipPosition="below"
            matTooltipClass="search-filter-tooltip">
            manage_search
          </mat-icon>
          <input
            type="text"
            class="filter-input"
            placeholder="Buscar..."
            (input)="onFilterChange($any($event.target).value)"
            #filterInput>
          <button *ngIf="isFiltered" mat-icon-button class="clear-button" (click)="clearFilter()">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <button mat-button class="action-button" [matMenuTriggerFor]="sortMenu">
          <mat-icon class="icon">sort</mat-icon>
          Ordenar por
        </button>

        <button mat-button class="action-button" (click)="toggleSortDirection()">
          <mat-icon class="icon">{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
          {{ sortDirection === 'asc' ? 'Ascendente' : 'Descendente' }}
        </button>
      </div>
    </div>

    <!-- Sección inferior: Acciones de cambio de estado -->
    <div class="buttons-container actions-section">

      <button mat-button class="action-button" (click)="markAllAsOnWork()">
        <mat-icon class="icon">construction</mat-icon>
        Marcar TODAS como "En revisión"
      </button>

      <button mat-button class="action-button" (click)="markSelectedAsOnWork()">
        <mat-icon class="icon">construction</mat-icon>
        Marcar seleccionadas como "En revisión"
      </button>

      <button mat-button class="action-button" (click)="markSelectedAsPending()">
        <mat-icon class="icon">pending_actions</mat-icon>
        Marcar seleccionadas como "Pendiente"
      </button>

      <button mat-button class="action-button" (click)="changeIsActiveState()">
        <mat-icon class="icon">done_outline</mat-icon>
        Marcar seleccionadas como "Finalizada"
      </button>
    </div>
  </div>

  <!-- Indicador de filtro activo -->
  <div *ngIf="isFiltered" class="filter-info">
    <mat-icon>info</mat-icon>
    <span>Mostrando {{ filteredCount }} de {{ allRequests.length }} solicitudes</span>
  </div>

<mat-menu #sortMenu="matMenu">
  <button mat-menu-item (click)="setSortBy('receivedAt')" [class.selected-sort]="sortBy === 'receivedAt'">
    <mat-icon>schedule</mat-icon>
    <span>Fecha Recibido</span>
    <mat-icon *ngIf="sortBy === 'receivedAt'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('requestNumber')" [class.selected-sort]="sortBy === 'requestNumber'">
    <mat-icon>tag</mat-icon>
    <span>N° de Solicitud</span>
    <mat-icon *ngIf="sortBy === 'requestNumber'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('paymentOrderNumber')" [class.selected-sort]="sortBy === 'paymentOrderNumber'">
    <mat-icon>receipt</mat-icon>
    <span>N° de Orden de Pago</span>
    <mat-icon *ngIf="sortBy === 'paymentOrderNumber'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('concept')" [class.selected-sort]="sortBy === 'concept'">
    <mat-icon>description</mat-icon>
    <span>Concepto, Proveedor o Contratista</span>
    <mat-icon *ngIf="sortBy === 'concept'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('dueDate')" [class.selected-sort]="sortBy === 'dueDate'">
    <mat-icon>event</mat-icon>
    <span>Vencimiento y/o Periodo</span>
    <mat-icon *ngIf="sortBy === 'dueDate'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('amount')" [class.selected-sort]="sortBy === 'amount'">
    <mat-icon>attach_money</mat-icon>
    <span>Importe Solicitado</span>
    <mat-icon *ngIf="sortBy === 'amount'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('fundingSource')" [class.selected-sort]="sortBy === 'fundingSource'">
    <mat-icon>account_balance</mat-icon>
    <span>Fuente de Financiamiento</span>
    <mat-icon *ngIf="sortBy === 'fundingSource'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('checkingAccount')" [class.selected-sort]="sortBy === 'checkingAccount'">
    <mat-icon>account_balance_wallet</mat-icon>
    <span>Cuenta Corriente</span>
    <mat-icon *ngIf="sortBy === 'checkingAccount'" class="check-icon">check</mat-icon>
  </button>
  <button mat-menu-item (click)="setSortBy('partialPayment')" [class.selected-sort]="sortBy === 'partialPayment'">
    <mat-icon>payments</mat-icon>
    <span>Pago Parcial</span>
    <mat-icon *ngIf="sortBy === 'partialPayment'" class="check-icon">check</mat-icon>
  </button>
</mat-menu>


<div *ngFor="let group of groupedRequests">
  <app-da-card
    [daTitle]="'D.A. ' + group.da"
    [requests]="group.requests"
    [highlightedRequestId]="highlightedRequestId"
    (selectedRequestsChanged)="onSelectedRequestsChanged('D.A. ' + group.da, $event)">
  </app-da-card>

  <div class="total-row">
    Total pendiente:

      {{ getTotalAmount(group.requests) | currency:'ARS':'symbol':'1.2-2':'es-AR' }}

  </div>
</div>
</div>
